<script type="module">
  import { PGlite } from "../dist/index.js";
  // import { PGlite } from "https://cdn.jsdelivr.net/npm/@electric-sql/pglite/dist/index.js";

  console.log("Starting...");
  const pg = new PGlite();
  // const pg = new PGlite('idb://pgdata');

  console.log("Waiting for ready...");
  await pg.waitReady;

  // process.exit(0);

  console.log("Ready!");

  console.log("Creating table...");
  await pg.exec(`
    CREATE TABLE IF NOT EXISTS test (
      id SERIAL PRIMARY KEY,
      name TEXT
    );
  `);

  console.log("Inserting data...");
  await pg.exec("INSERT INTO test (name) VALUES ('test');");

  console.log("Selecting data...");
  const res = await pg.exec(`
    SELECT * FROM test;
  `);

  console.log(res);

  const res2 = await pg.exec(`
    SELECT 1, 2, 3;
  `);
  console.log(res2);

  // try {
  //   await pg.exec('1');
  // } catch (e) {
  //   console.log('Error caught:');
  //   console.log(e);
  // }

  // console.log(await pg.exec("SELECT * FROM test;"));

  // // Test transaction

  // await pg.exec("BEGIN;");
  // await pg.exec("INSERT INTO test (name) VALUES ('test2');");
  // await pg.exec("ROLLBACK;");
  // console.log(await pg.exec("SELECT * FROM test;"));

  // await pg.exec("BEGIN;");
  // await pg.exec("INSERT INTO test (name) VALUES ('test3');");
  // await pg.exec("COMMIT;");
  // console.log(await pg.exec("SELECT * FROM test;"));

  // console.log("Closing...");
  // await pg.close();
  // console.log('Closed');
</script>
